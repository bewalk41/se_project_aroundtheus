!function(){"use strict";class e{constructor(e,t,s,n,i){let{name:r,link:o,_id:a,likes:l}=e;this._name=r,this._link=o,this._id=a,this._likes=l||[],this._cardSelector=t,this._handleImageClick=s,this._handleDeleteClick=n,this._api=i,this._isLiked=this._likes.length>0}_setEventListeners(){this._cardElement.querySelector(".card__like-button").addEventListener("click",(()=>{this._handleLikeIcon()})),this._cardElement.querySelector(".card__trash-button").addEventListener("click",(()=>{this._handleDeleteCard()})),this._cardElement.querySelector(".card__image").addEventListener("click",(()=>{"function"==typeof this._handleImageClick&&this._handleImageClick(this._link,this._name)}))}_handleLikeIcon(){this.isLiked()?this._dislikeCard():this._likeCard()}_likeCard(){this._api.likeCard(this._id).then((e=>{this.setIsLiked(!0),this._likes=e.likes,this._renderLikes()})).catch((e=>console.error(e)))}_dislikeCard(){this._api.dislikeCard(this._id).then((e=>{this.setIsLiked(!1),this._likes=e.likes,this._renderLikes()})).catch((e=>console.error(e)))}setIsLiked(e){this._isLiked=e,this._renderLikes()}isLiked(){return this._isLiked}_renderLikes(){const e=this._cardElement.querySelector(".card__like-button");this._isLiked?e.classList.add("card__like-button_active"):e.classList.remove("card__like-button_active")}_handleDeleteCard(){"function"==typeof this._handleDeleteClick&&this._handleDeleteClick(this._id,this._cardElement)}getView(){this._cardElement=document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0),this._cardElement.querySelector(".card__header").textContent=this._name;const e=this._cardElement.querySelector(".card__image");return e.src=this._link,e.alt=this._name,this._renderLikes(),this._setEventListeners(),this._cardElement}}var t=class{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t,this._submitButton=this._formElement.querySelector(this._submitButtonSelector),this._inputEls=Array.from(this._formElement.querySelectorAll(this._inputSelector))}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_showInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);t.textContent=e.validationMessage,e.classList.add(this._inputErrorClass),t.classList.add(this._errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);t.textContent="",e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass)}_hasInvalidInput(){return this._inputEls.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?this._disableButton():this._enableButton()}_disableButton(){this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0}_enableButton(){this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1}_setEventListeners(){this._inputEls.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners(),this._toggleButtonState()}resetValidation(){this._inputEls.forEach((e=>{this._hideInputError(e)})),this._toggleButtonState()}toggleButtonState(){this._toggleButtonState()}},s=class{constructor(e){this._popupElement=document.querySelector(e),this._closeButton=this._popupElement.querySelector(".modal__close"),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popupElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._closeButton.addEventListener("click",(()=>this.close())),this._popupElement.addEventListener("mousedown",(e=>{e.target===this._popupElement&&this.close()}))}},n=class extends s{constructor(e,t){super(e),this._handleFormSubmit=t,this._form=this._popupElement.querySelector(".modal__form"),this._inputList=this._form.querySelectorAll(".modal__input"),this._submitButton=this._form.querySelector(".modal__button"),this._submitButtonText=this._submitButton.textContent}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setInputValues(e){this._inputList.forEach((t=>{t.value=e[t.name]}))}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}close(){super.close(),this._form.reset()}renderLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...";this._submitButton.textContent=e?t:this._submitButtonText}},i=class extends s{constructor(e){super(e),this._imageElement=this._popupElement.querySelector(".modal__image"),this._captionElement=this._popupElement.querySelector(".modal__caption")}open(e){let{name:t,link:s}=e;this._imageElement.src=s,this._imageElement.alt=t,this._captionElement.textContent=t,super.open()}};class r extends s{constructor(e){super(e),this._confirmButton=this._popupElement.querySelector(".modal__button_confirm"),this._confirmButtonText=this._confirmButton.textContent}setConfirmationHandler(e){this._handleConfirm=e}open(e){super.open(),this._data=e}setEventListeners(){super.setEventListeners(),this._confirmButton.addEventListener("click",(()=>{this._handleConfirm&&this._handleConfirm(this._data)}))}renderLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...";this._confirmButton.textContent=e?t:this._confirmButtonText}}var o=class{constructor(e){let{nameSelector:t,jobSelector:s,avatarSelector:n}=e;this._nameElement=document.querySelector(t),this._jobElement=document.querySelector(s),this._avatarElement=document.querySelector(n)}getUserInfo(){return{name:this._nameElement.textContent,job:this._jobElement.textContent,avatar:this._avatarElement.src}}setUserInfo(e){let{name:t,about:s}=e;t&&(this._nameElement.textContent=t),s&&(this._jobElement.textContent=s)}setUserAvatar(e){e&&(this._avatarElement.src=e)}};class a{constructor(e,t){let{items:s,renderer:n}=e;this._items=s||[],this._renderer=n,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}const l=[{name:"Yosemite Valley",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/yosemite.jpg"},{name:"Lake Louise",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/lake-louise.jpg"},{name:"Bald Mountains",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/bald-mountains.jpg"},{name:"Latemar",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/latemar.jpg"},{name:"Vanoise National Park",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/vanoise.jpg"},{name:"Lago di Braies",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/around-project/lago.jpg"}],c={inputSelector:".modal__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"};var d=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}setUserInfo(e){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:{...this._headers,"Content-Type":"application/json"},body:JSON.stringify(e)}).then(this._checkResponse)}addCard(e){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:{...this._headers,"Content-Type":"application/json"},body:JSON.stringify(e)}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}likeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}dislikeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}setUserAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:{...this._headers,"Content-Type":"application/json"},body:JSON.stringify(e)}).then(this._checkResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"f2772a6b-ab7a-4d91-8e26-99a73e7be810","Content-Type":"application/json"}});document.addEventListener("DOMContentLoaded",(()=>{const s=document.querySelector("#profile-edit-button"),h=document.querySelector("#add-card-button"),_=document.querySelector(".profile__image-button"),u=new o({nameSelector:".profile__name",jobSelector:".profile__description",avatarSelector:".profile__image"}),m=new t(c,document.querySelector("#profile-edit-modal .modal__form")),p=new t(c,document.querySelector("#add-card-modal .modal__form"));m.enableValidation(),p.enableValidation();const E=(e,t)=>{v.open({name:t,link:e})},f=new n("#profile-edit-modal",(e=>{f.renderLoading(!0),d.setUserInfo({name:e.heading,about:e.description}).then((e=>{u.setUserInfo(e),f.close()})).catch((e=>console.error(e))).finally((()=>f.renderLoading(!1)))})),k=new n("#add-card-modal",(e=>{k.renderLoading(!0);const t={name:e.heading,link:e.description};d.addCard(t).then((e=>{const t=b(e);C.addItem(t),k.close()})).catch((e=>console.error(e))).finally((()=>k.renderLoading(!1)))})),v=new i("#image-modal"),g=new r("#confirm-popup");g.setEventListeners(),g.setConfirmationHandler((e=>{let{cardId:t,cardElement:s}=e;g.renderLoading(!0,"Deleting..."),d.deleteCard(t).then((()=>{s.remove(),g.close()})).catch((e=>console.error(e))).finally((()=>g.renderLoading(!1)))})),f.setEventListeners(),k.setEventListeners(),v.setEventListeners();const L=new n("#profile-popup",(e=>{L.renderLoading(!0),d.setUserAvatar({avatar:e.description}).then((e=>{u.setUserAvatar(e.avatar),L.close()})).catch((e=>console.error(e))).finally((()=>L.renderLoading(!1)))}));function b(t){return new e(t,"#card-template",E,((e,t)=>{g.open({cardId:e,cardElement:t})}),d).getView()}L.setEventListeners();const C=new a({items:l,renderer:e=>{const t=b(e);C.addItem(t)}},".cards__list");s.addEventListener("click",(()=>{const e=u.getUserInfo();f.setInputValues({heading:e.name,description:e.job}),f.open(),m.resetValidation()})),h.addEventListener("click",(()=>{k.open(),p.toggleButtonState()})),_.addEventListener("click",(()=>{L.open()})),Promise.all([d.getUserInfo(),d.getInitialCards()]).then((e=>{let[t,s]=e;u.setUserInfo(t),u.setUserAvatar(t.avatar),C.renderItems(s)})).catch((e=>console.error("Error fetching data:",e)))}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZCxDQWJBNkosRUFBa0JwRyxvQkFlbEIsTUFBTWlHLEVBQVUsSUFBSXRELEVBQ2xCLENBQ0VFLE1BQU9VLEVBQ1BULFNBQVdnRCxJQUNULE1BQU1DLEVBQWNDLEVBQWVGLEdBQ25DRyxFQUFRN0MsUUFBUTJDLEVBQVksR0FHaEMsZ0JBR0ZqQixFQUFrQjNKLGlCQUFpQixTQUFTLEtBQzFDLE1BQU1rTCxFQUFXcEIsRUFBUzdDLGNBQzFCbUQsRUFBaUJ6RSxlQUFlLENBQzlCNEUsUUFBU1csRUFBU25NLEtBQ2xCeUwsWUFBYVUsRUFBU2hFLE1BRXhCa0QsRUFBaUI1RixPQUNqQndGLEVBQWtCL0YsaUJBQWlCLElBR3JDMkYsRUFBYzVKLGlCQUFpQixTQUFTLEtBQ3RDMEssRUFBYWxHLE9BQ2IwRixFQUFxQmhHLG1CQUFtQixJQUcxQzJGLEVBQW1CN0osaUJBQWlCLFNBQVMsS0FDM0NpTCxFQUFrQnpHLE1BQU0sSUFJMUJzRSxRQUFRcUMsSUFBSSxDQUFDck0sRUFBQUEsY0FBbUJBLEVBQUFBLG9CQUM3QnlCLE1BQUs4RyxJQUE4QixJQUE1QjZELEVBQVU5QyxHQUFhZixFQUM3QnlDLEVBQVMxQyxZQUFZOEQsR0FDckJwQixFQUFTdkMsY0FBYzJELEVBQVMvRCxRQUNoQzJELEVBQVEvQyxZQUFZSyxFQUFhLElBRWxDekgsT0FBT0MsR0FBUUMsUUFBUUMsTUFBTSx1QkFBd0JGLElBQUssRyIsInNvdXJjZXMiOlsid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm1hdGlvbi5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9wYWdlcy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHsgbmFtZSwgbGluaywgX2lkLCBsaWtlcyB9LFxyXG4gICAgY2FyZFNlbGVjdG9yLFxyXG4gICAgaGFuZGxlSW1hZ2VDbGljayxcclxuICAgIGhhbmRsZURlbGV0ZUNsaWNrLFxyXG4gICAgYXBpXHJcbiAgKSB7XHJcbiAgICB0aGlzLl9uYW1lID0gbmFtZTtcclxuICAgIHRoaXMuX2xpbmsgPSBsaW5rO1xyXG4gICAgdGhpcy5faWQgPSBfaWQ7XHJcbiAgICB0aGlzLl9saWtlcyA9IGxpa2VzIHx8IFtdO1xyXG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xyXG4gICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayA9IGhhbmRsZUltYWdlQ2xpY2s7XHJcbiAgICB0aGlzLl9oYW5kbGVEZWxldGVDbGljayA9IGhhbmRsZURlbGV0ZUNsaWNrO1xyXG4gICAgdGhpcy5fYXBpID0gYXBpO1xyXG4gICAgdGhpcy5faXNMaWtlZCA9IHRoaXMuX2xpa2VzLmxlbmd0aCA+IDA7IC8vIGFzc3VtaW5nIHRoZSBjYXJkIGlzIGxpa2VkIGlmIHRoZXJlIGFyZSBhbnkgbGlrZXNcclxuICB9XHJcblxyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2NhcmRFbGVtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpXHJcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2hhbmRsZUxpa2VJY29uKCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIHRoaXMuX2NhcmRFbGVtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RyYXNoLWJ1dHRvblwiKVxyXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICB0aGlzLl9oYW5kbGVEZWxldGVDYXJkKCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGNhcmRJbWFnZUVsID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcclxuICAgIGNhcmRJbWFnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5faGFuZGxlSW1hZ2VDbGljayA9PT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayh0aGlzLl9saW5rLCB0aGlzLl9uYW1lKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfaGFuZGxlTGlrZUljb24oKSB7XHJcbiAgICBpZiAodGhpcy5pc0xpa2VkKCkpIHtcclxuICAgICAgdGhpcy5fZGlzbGlrZUNhcmQoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2xpa2VDYXJkKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfbGlrZUNhcmQoKSB7XHJcbiAgICB0aGlzLl9hcGlcclxuICAgICAgLmxpa2VDYXJkKHRoaXMuX2lkKVxyXG4gICAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICAgIHRoaXMuc2V0SXNMaWtlZCh0cnVlKTtcclxuICAgICAgICB0aGlzLl9saWtlcyA9IGRhdGEubGlrZXM7XHJcbiAgICAgICAgdGhpcy5fcmVuZGVyTGlrZXMoKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSk7XHJcbiAgfVxyXG5cclxuICBfZGlzbGlrZUNhcmQoKSB7XHJcbiAgICB0aGlzLl9hcGlcclxuICAgICAgLmRpc2xpa2VDYXJkKHRoaXMuX2lkKVxyXG4gICAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICAgIHRoaXMuc2V0SXNMaWtlZChmYWxzZSk7XHJcbiAgICAgICAgdGhpcy5fbGlrZXMgPSBkYXRhLmxpa2VzO1xyXG4gICAgICAgIHRoaXMuX3JlbmRlckxpa2VzKCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpO1xyXG4gIH1cclxuXHJcbiAgc2V0SXNMaWtlZChpc0xpa2VkKSB7XHJcbiAgICB0aGlzLl9pc0xpa2VkID0gaXNMaWtlZDtcclxuICAgIHRoaXMuX3JlbmRlckxpa2VzKCk7XHJcbiAgfVxyXG5cclxuICBpc0xpa2VkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2lzTGlrZWQ7XHJcbiAgfVxyXG5cclxuICBfcmVuZGVyTGlrZXMoKSB7XHJcbiAgICBjb25zdCBsaWtlQnV0dG9uID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKTtcclxuICAgIGlmICh0aGlzLl9pc0xpa2VkKSB7XHJcbiAgICAgIGxpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxpa2VCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9oYW5kbGVEZWxldGVDYXJkKCkge1xyXG4gICAgaWYgKHR5cGVvZiB0aGlzLl9oYW5kbGVEZWxldGVDbGljayA9PT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNsaWNrKHRoaXMuX2lkLCB0aGlzLl9jYXJkRWxlbWVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXRWaWV3KCkge1xyXG4gICAgdGhpcy5fY2FyZEVsZW1lbnQgPSBkb2N1bWVudFxyXG4gICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkU2VsZWN0b3IpXHJcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKVxyXG4gICAgICAuY2xvbmVOb2RlKHRydWUpO1xyXG5cclxuICAgIGNvbnN0IGNhcmRUaXRsZSA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faGVhZGVyXCIpO1xyXG4gICAgY2FyZFRpdGxlLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcclxuXHJcbiAgICBjb25zdCBjYXJkSW1hZ2UgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xyXG4gICAgY2FyZEltYWdlLnNyYyA9IHRoaXMuX2xpbms7XHJcbiAgICBjYXJkSW1hZ2UuYWx0ID0gdGhpcy5fbmFtZTtcclxuXHJcbiAgICB0aGlzLl9yZW5kZXJMaWtlcygpO1xyXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5fY2FyZEVsZW1lbnQ7XHJcbiAgfVxyXG59XHJcbiIsImNsYXNzIEZvcm1WYWxpZGF0b3Ige1xyXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMsIGZvcm1FbGVtZW50KSB7XHJcbiAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gb3B0aW9ucy5pbnB1dFNlbGVjdG9yO1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBvcHRpb25zLnN1Ym1pdEJ1dHRvblNlbGVjdG9yO1xyXG4gICAgdGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyA9IG9wdGlvbnMuaW5hY3RpdmVCdXR0b25DbGFzcztcclxuICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IG9wdGlvbnMuaW5wdXRFcnJvckNsYXNzO1xyXG4gICAgdGhpcy5fZXJyb3JDbGFzcyA9IG9wdGlvbnMuZXJyb3JDbGFzcztcclxuXHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3JcclxuICAgICk7XHJcbiAgICB0aGlzLl9pbnB1dEVscyA9IEFycmF5LmZyb20oXHJcbiAgICAgIHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5faW5wdXRTZWxlY3RvcilcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWwpIHtcclxuICAgIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWwpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX3Nob3dJbnB1dEVycm9yKGlucHV0RWwpIHtcclxuICAgIGNvbnN0IGVycm9yRWwgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xyXG4gICAgZXJyb3JFbC50ZXh0Q29udGVudCA9IGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2U7XHJcbiAgICBpbnB1dEVsLmNsYXNzTGlzdC5hZGQodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcclxuICAgIGVycm9yRWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9lcnJvckNsYXNzKTtcclxuICB9XHJcblxyXG4gIF9oaWRlSW5wdXRFcnJvcihpbnB1dEVsKSB7XHJcbiAgICBjb25zdCBlcnJvckVsID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcclxuICAgIGVycm9yRWwudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICBlcnJvckVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgfVxyXG5cclxuICBfaGFzSW52YWxpZElucHV0KCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2lucHV0RWxzLnNvbWUoKGlucHV0RWwpID0+ICFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKTtcclxuICB9XHJcblxyXG4gIF90b2dnbGVCdXR0b25TdGF0ZSgpIHtcclxuICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoKSkge1xyXG4gICAgICB0aGlzLl9kaXNhYmxlQnV0dG9uKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9lbmFibGVCdXR0b24oKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9kaXNhYmxlQnV0dG9uKCkge1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5hZGQodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgX2VuYWJsZUJ1dHRvbigpIHtcclxuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9pbnB1dEVscy5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XHJcbiAgICAgIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcclxuICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbCk7XHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgfVxyXG5cclxuICByZXNldFZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9pbnB1dEVscy5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XHJcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWwpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG4gIH1cclxuXHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoKSB7XHJcbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgRm9ybVZhbGlkYXRvcjtcclxuIiwiY2xhc3MgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHRoaXMuX3BvcHVwRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9jbG9zZUJ1dHRvbiA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZVwiKTtcclxuICAgIHRoaXMuX2hhbmRsZUVzY0Nsb3NlID0gdGhpcy5faGFuZGxlRXNjQ2xvc2UuYmluZCh0aGlzKTtcclxuICB9XHJcblxyXG4gIG9wZW4oKSB7XHJcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcIm1vZGFsX29wZW5lZFwiKTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICB9XHJcblxyXG4gIGNsb3NlKCkge1xyXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9vcGVuZWRcIik7XHJcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgfVxyXG5cclxuICBfaGFuZGxlRXNjQ2xvc2UoZXZlbnQpIHtcclxuICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9jbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5jbG9zZSgpKTtcclxuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChldnQpID0+IHtcclxuICAgICAgaWYgKGV2dC50YXJnZXQgPT09IHRoaXMuX3BvcHVwRWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBQb3B1cDtcclxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5jbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQpIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XHJcbiAgICB0aGlzLl9mb3JtID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XHJcbiAgICB0aGlzLl9pbnB1dExpc3QgPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2lucHV0XCIpO1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19idXR0b25cIik7XHJcbiAgICB0aGlzLl9zdWJtaXRCdXR0b25UZXh0ID0gdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50O1xyXG4gIH1cclxuXHJcbiAgX2dldElucHV0VmFsdWVzKCkge1xyXG4gICAgdGhpcy5fZm9ybVZhbHVlcyA9IHt9O1xyXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XHJcbiAgICAgIHRoaXMuX2Zvcm1WYWx1ZXNbaW5wdXQubmFtZV0gPSBpbnB1dC52YWx1ZTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRoaXMuX2Zvcm1WYWx1ZXM7XHJcbiAgfVxyXG5cclxuICBzZXRJbnB1dFZhbHVlcyhkYXRhKSB7XHJcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtcclxuICAgICAgaW5wdXQudmFsdWUgPSBkYXRhW2lucHV0Lm5hbWVdO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xyXG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICBzdXBlci5jbG9zZSgpO1xyXG4gICAgdGhpcy5fZm9ybS5yZXNldCgpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcsIGxvYWRpbmdUZXh0ID0gXCJTYXZpbmcuLi5cIikge1xyXG4gICAgaWYgKGlzTG9hZGluZykge1xyXG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IHRoaXMuX3N1Ym1pdEJ1dHRvblRleHQ7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBQb3B1cFdpdGhGb3JtO1xyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5faW1hZ2VFbGVtZW50ID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xyXG4gICAgdGhpcy5fY2FwdGlvbkVsZW1lbnQgPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FwdGlvblwiKTtcclxuICB9XHJcblxyXG4gIG9wZW4oeyBuYW1lLCBsaW5rIH0pIHtcclxuICAgIHRoaXMuX2ltYWdlRWxlbWVudC5zcmMgPSBsaW5rO1xyXG4gICAgdGhpcy5faW1hZ2VFbGVtZW50LmFsdCA9IG5hbWU7XHJcbiAgICB0aGlzLl9jYXB0aW9uRWxlbWVudC50ZXh0Q29udGVudCA9IG5hbWU7XHJcbiAgICBzdXBlci5vcGVuKCk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBQb3B1cFdpdGhJbWFnZTtcclxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhDb25maXJtYXRpb24gZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xyXG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9jb25maXJtQnV0dG9uID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIFwiLm1vZGFsX19idXR0b25fY29uZmlybVwiXHJcbiAgICApO1xyXG4gICAgdGhpcy5fY29uZmlybUJ1dHRvblRleHQgPSB0aGlzLl9jb25maXJtQnV0dG9uLnRleHRDb250ZW50OyAvLyBTdG9yZSB0aGUgaW5pdGlhbCBidXR0b24gdGV4dFxyXG4gIH1cclxuXHJcbiAgc2V0Q29uZmlybWF0aW9uSGFuZGxlcihoYW5kbGVyKSB7XHJcbiAgICB0aGlzLl9oYW5kbGVDb25maXJtID0gaGFuZGxlcjtcclxuICB9XHJcblxyXG4gIG9wZW4oZGF0YSkge1xyXG4gICAgc3VwZXIub3BlbigpO1xyXG4gICAgdGhpcy5fZGF0YSA9IGRhdGE7IC8vIFN0b3JlIHRoZSBkYXRhIG5lZWRlZCBmb3IgY29uZmlybWF0aW9uXHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9jb25maXJtQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLl9oYW5kbGVDb25maXJtKSB7XHJcbiAgICAgICAgdGhpcy5faGFuZGxlQ29uZmlybSh0aGlzLl9kYXRhKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZW5kZXJMb2FkaW5nKGlzTG9hZGluZywgbG9hZGluZ1RleHQgPSBcIlNhdmluZy4uLlwiKSB7XHJcbiAgICBpZiAoaXNMb2FkaW5nKSB7XHJcbiAgICAgIHRoaXMuX2NvbmZpcm1CdXR0b24udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2NvbmZpcm1CdXR0b24udGV4dENvbnRlbnQgPSB0aGlzLl9jb25maXJtQnV0dG9uVGV4dDtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIiwiY2xhc3MgVXNlckluZm8ge1xyXG4gIGNvbnN0cnVjdG9yKHsgbmFtZVNlbGVjdG9yLCBqb2JTZWxlY3RvciwgYXZhdGFyU2VsZWN0b3IgfSkge1xyXG4gICAgdGhpcy5fbmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9qb2JFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihqb2JTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9hdmF0YXJFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhdmF0YXJTZWxlY3Rvcik7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50LFxyXG4gICAgICBqb2I6IHRoaXMuX2pvYkVsZW1lbnQudGV4dENvbnRlbnQsXHJcbiAgICAgIGF2YXRhcjogdGhpcy5fYXZhdGFyRWxlbWVudC5zcmMsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgc2V0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XHJcbiAgICBpZiAobmFtZSkge1xyXG4gICAgICB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCA9IG5hbWU7XHJcbiAgICB9XHJcbiAgICBpZiAoYWJvdXQpIHtcclxuICAgICAgdGhpcy5fam9iRWxlbWVudC50ZXh0Q29udGVudCA9IGFib3V0OyAvLyBFbnN1cmUgJ2Fib3V0JyBpcyB1c2VkIGZvciBqb2JcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNldFVzZXJBdmF0YXIoYXZhdGFyKSB7XHJcbiAgICBpZiAoYXZhdGFyKSB7XHJcbiAgICAgIHRoaXMuX2F2YXRhckVsZW1lbnQuc3JjID0gYXZhdGFyO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgVXNlckluZm87XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xyXG4gIGNvbnN0cnVjdG9yKHsgaXRlbXMsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XHJcbiAgICB0aGlzLl9pdGVtcyA9IGl0ZW1zIHx8IFtdOyAvLyBFbnN1cmUgaXRlbXMgaXMgYW4gYXJyYXlcclxuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XHJcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIHJlbmRlckl0ZW1zKCkge1xyXG4gICAgdGhpcy5faXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYWRkSXRlbShlbGVtZW50KSB7XHJcbiAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcclxuICB9XHJcbn1cclxuIiwiLy8gdXRpbHMvY29uc3RhbnRzLmpzXHJcbmV4cG9ydCBjb25zdCBpbml0aWFsQ2FyZHMgPSBbXHJcbiAge1xyXG4gICAgbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC95b3NlbWl0ZS5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiTGFrZSBMb3Vpc2VcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9sYWtlLWxvdWlzZS5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiQmFsZCBNb3VudGFpbnNcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9iYWxkLW1vdW50YWlucy5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiTGF0ZW1hclwiLFxyXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2xhdGVtYXIuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIlZhbm9pc2UgTmF0aW9uYWwgUGFya1wiLFxyXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L3Zhbm9pc2UuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIkxhZ28gZGkgQnJhaWVzXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvbGFnby5qcGdcIixcclxuICB9LFxyXG5dO1xyXG5cclxuZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25PcHRpb25zID0ge1xyXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fYnV0dG9uXCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fYnV0dG9uX2Rpc2FibGVkXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXHJcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiLFxyXG59O1xyXG4iLCJjbGFzcyBBcGkge1xyXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcclxuICAgIHRoaXMuX2Jhc2VVcmwgPSBvcHRpb25zLmJhc2VVcmw7XHJcbiAgICB0aGlzLl9oZWFkZXJzID0gb3B0aW9ucy5oZWFkZXJzO1xyXG4gIH1cclxuXHJcbiAgX2NoZWNrUmVzcG9uc2UocmVzKSB7XHJcbiAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcclxuICB9XHJcblxyXG4gIHNldFVzZXJJbmZvKGRhdGEpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAuLi50aGlzLl9oZWFkZXJzLFxyXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKSxcclxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XHJcbiAgfVxyXG5cclxuICBhZGRDYXJkKGRhdGEpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgIC4uLnRoaXMuX2hlYWRlcnMsXHJcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgIH0sXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxyXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgbGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgZGlzbGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgc2V0VXNlckF2YXRhcihkYXRhKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgIC4uLnRoaXMuX2hlYWRlcnMsXHJcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgIH0sXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxyXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcImYyNzcyYTZiLWFiN2EtNGQ5MS04ZTI2LTk5YTczZTdiZTgxMFwiLFxyXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgfSxcclxufSk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhcGk7XHJcbiIsImltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcclxuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoQ29uZmlybWF0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm1hdGlvbi5qc1wiO1xyXG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcclxuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xyXG5pbXBvcnQgeyB2YWxpZGF0aW9uT3B0aW9ucywgaW5pdGlhbENhcmRzIH0gZnJvbSBcIi4uL3V0aWxzL2NvbnN0YW50cy5qc1wiO1xyXG5pbXBvcnQgXCIuLi9wYWdlcy9pbmRleC5jc3NcIjtcclxuaW1wb3J0IGFwaSBmcm9tIFwiLi4vY29tcG9uZW50cy9BcGkuanNcIjtcclxuXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcclxuICBjb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1lZGl0LWJ1dHRvblwiKTtcclxuICBjb25zdCBhZGRDYXJkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1idXR0b25cIik7XHJcbiAgY29uc3QgcHJvZmlsZUltYWdlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19pbWFnZS1idXR0b25cIik7XHJcblxyXG4gIGNvbnN0IHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKHtcclxuICAgIG5hbWVTZWxlY3RvcjogXCIucHJvZmlsZV9fbmFtZVwiLFxyXG4gICAgam9iU2VsZWN0b3I6IFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIsXHJcbiAgICBhdmF0YXJTZWxlY3RvcjogXCIucHJvZmlsZV9faW1hZ2VcIixcclxuICB9KTtcclxuXHJcbiAgY29uc3QgZWRpdEZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihcclxuICAgIHZhbGlkYXRpb25PcHRpb25zLFxyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWVkaXQtbW9kYWwgLm1vZGFsX19mb3JtXCIpXHJcbiAgKTtcclxuICBjb25zdCBhZGRDYXJkRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKFxyXG4gICAgdmFsaWRhdGlvbk9wdGlvbnMsXHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkLW1vZGFsIC5tb2RhbF9fZm9ybVwiKVxyXG4gICk7XHJcblxyXG4gIGVkaXRGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuICBhZGRDYXJkRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcblxyXG4gIGNvbnN0IGhhbmRsZUltYWdlQ2xpY2sgPSAobGluaywgbmFtZSkgPT4ge1xyXG4gICAgaW1hZ2VQb3B1cC5vcGVuKHsgbmFtZSwgbGluayB9KTtcclxuICB9O1xyXG5cclxuICBjb25zdCBwcm9maWxlRWRpdFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXHJcbiAgICBcIiNwcm9maWxlLWVkaXQtbW9kYWxcIixcclxuICAgIChmb3JtRGF0YSkgPT4ge1xyXG4gICAgICBwcm9maWxlRWRpdFBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSk7XHJcbiAgICAgIGFwaVxyXG4gICAgICAgIC5zZXRVc2VySW5mbyh7XHJcbiAgICAgICAgICBuYW1lOiBmb3JtRGF0YS5oZWFkaW5nLFxyXG4gICAgICAgICAgYWJvdXQ6IGZvcm1EYXRhLmRlc2NyaXB0aW9uLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKGRhdGEpO1xyXG4gICAgICAgICAgcHJvZmlsZUVkaXRQb3B1cC5jbG9zZSgpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSlcclxuICAgICAgICAuZmluYWxseSgoKSA9PiBwcm9maWxlRWRpdFBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UpKTtcclxuICAgIH1cclxuICApO1xyXG5cclxuICBjb25zdCBhZGRDYXJkUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcIiNhZGQtY2FyZC1tb2RhbFwiLCAoZm9ybURhdGEpID0+IHtcclxuICAgIGFkZENhcmRQb3B1cC5yZW5kZXJMb2FkaW5nKHRydWUpO1xyXG4gICAgY29uc3QgY2FyZERhdGEgPSB7IG5hbWU6IGZvcm1EYXRhLmhlYWRpbmcsIGxpbms6IGZvcm1EYXRhLmRlc2NyaXB0aW9uIH07XHJcbiAgICBhcGlcclxuICAgICAgLmFkZENhcmQoY2FyZERhdGEpXHJcbiAgICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChkYXRhKTtcclxuICAgICAgICBzZWN0aW9uLmFkZEl0ZW0oY2FyZEVsZW1lbnQpO1xyXG4gICAgICAgIGFkZENhcmRQb3B1cC5jbG9zZSgpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIpKVxyXG4gICAgICAuZmluYWxseSgoKSA9PiBhZGRDYXJkUG9wdXAucmVuZGVyTG9hZGluZyhmYWxzZSkpO1xyXG4gIH0pO1xyXG5cclxuICBjb25zdCBpbWFnZVBvcHVwID0gbmV3IFBvcHVwV2l0aEltYWdlKFwiI2ltYWdlLW1vZGFsXCIpO1xyXG5cclxuICBjb25zdCBjb25maXJtUG9wdXAgPSBuZXcgUG9wdXBXaXRoQ29uZmlybWF0aW9uKFwiI2NvbmZpcm0tcG9wdXBcIik7XHJcbiAgY29uZmlybVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG4gIGNvbmZpcm1Qb3B1cC5zZXRDb25maXJtYXRpb25IYW5kbGVyKCh7IGNhcmRJZCwgY2FyZEVsZW1lbnQgfSkgPT4ge1xyXG4gICAgY29uZmlybVBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSwgXCJEZWxldGluZy4uLlwiKTtcclxuICAgIGFwaVxyXG4gICAgICAuZGVsZXRlQ2FyZChjYXJkSWQpXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICBjYXJkRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICBjb25maXJtUG9wdXAuY2xvc2UoKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSlcclxuICAgICAgLmZpbmFsbHkoKCkgPT4gY29uZmlybVBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UpKTtcclxuICB9KTtcclxuXHJcbiAgcHJvZmlsZUVkaXRQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gIGFkZENhcmRQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gIGltYWdlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbiAgY29uc3QgdXBkYXRlQXZhdGFyUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcIiNwcm9maWxlLXBvcHVwXCIsIChmb3JtRGF0YSkgPT4ge1xyXG4gICAgdXBkYXRlQXZhdGFyUG9wdXAucmVuZGVyTG9hZGluZyh0cnVlKTtcclxuICAgIGFwaVxyXG4gICAgICAuc2V0VXNlckF2YXRhcih7IGF2YXRhcjogZm9ybURhdGEuZGVzY3JpcHRpb24gfSlcclxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgICB1c2VySW5mby5zZXRVc2VyQXZhdGFyKGRhdGEuYXZhdGFyKTtcclxuICAgICAgICB1cGRhdGVBdmF0YXJQb3B1cC5jbG9zZSgpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIpKVxyXG4gICAgICAuZmluYWxseSgoKSA9PiB1cGRhdGVBdmF0YXJQb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlKSk7XHJcbiAgfSk7XHJcblxyXG4gIHVwZGF0ZUF2YXRhclBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG4gIGZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGRhdGEpIHtcclxuICAgIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcclxuICAgICAgZGF0YSxcclxuICAgICAgXCIjY2FyZC10ZW1wbGF0ZVwiLFxyXG4gICAgICBoYW5kbGVJbWFnZUNsaWNrLFxyXG4gICAgICAoY2FyZElkLCBjYXJkRWxlbWVudCkgPT4ge1xyXG4gICAgICAgIGNvbmZpcm1Qb3B1cC5vcGVuKHsgY2FyZElkLCBjYXJkRWxlbWVudCB9KTtcclxuICAgICAgfSxcclxuICAgICAgYXBpIC8vIHBhc3MgdGhlIGFwaSBpbnN0YW5jZVxyXG4gICAgKTtcclxuICAgIHJldHVybiBjYXJkLmdldFZpZXcoKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHNlY3Rpb24gPSBuZXcgU2VjdGlvbihcclxuICAgIHtcclxuICAgICAgaXRlbXM6IGluaXRpYWxDYXJkcywgLy8gVXNlIHRoZSBpbml0aWFsIGNhcmRzIGhlcmVcclxuICAgICAgcmVuZGVyZXI6IChjYXJkRGF0YSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoY2FyZERhdGEpO1xyXG4gICAgICAgIHNlY3Rpb24uYWRkSXRlbShjYXJkRWxlbWVudCk7XHJcbiAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgXCIuY2FyZHNfX2xpc3RcIlxyXG4gICk7XHJcblxyXG4gIHByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICBjb25zdCB1c2VyRGF0YSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XHJcbiAgICBwcm9maWxlRWRpdFBvcHVwLnNldElucHV0VmFsdWVzKHtcclxuICAgICAgaGVhZGluZzogdXNlckRhdGEubmFtZSxcclxuICAgICAgZGVzY3JpcHRpb246IHVzZXJEYXRhLmpvYixcclxuICAgIH0pO1xyXG4gICAgcHJvZmlsZUVkaXRQb3B1cC5vcGVuKCk7XHJcbiAgICBlZGl0Rm9ybVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24oKTtcclxuICB9KTtcclxuXHJcbiAgYWRkQ2FyZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgYWRkQ2FyZFBvcHVwLm9wZW4oKTtcclxuICAgIGFkZENhcmRGb3JtVmFsaWRhdG9yLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgfSk7XHJcblxyXG4gIHByb2ZpbGVJbWFnZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgdXBkYXRlQXZhdGFyUG9wdXAub3BlbigpO1xyXG4gIH0pO1xyXG5cclxuICAvLyBGZXRjaCB1c2VyIGluZm8gYW5kIHJlbmRlciBpbml0aWFsIGNhcmRzXHJcbiAgUHJvbWlzZS5hbGwoW2FwaS5nZXRVc2VySW5mbygpLCBhcGkuZ2V0SW5pdGlhbENhcmRzKCldKVxyXG4gICAgLnRoZW4oKFt1c2VyRGF0YSwgaW5pdGlhbENhcmRzXSkgPT4ge1xyXG4gICAgICB1c2VySW5mby5zZXRVc2VySW5mbyh1c2VyRGF0YSk7XHJcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIodXNlckRhdGEuYXZhdGFyKTtcclxuICAgICAgc2VjdGlvbi5yZW5kZXJJdGVtcyhpbml0aWFsQ2FyZHMpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgZGF0YTpcIiwgZXJyKSk7XHJcbn0pO1xyXG4iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiX3JlZiIsImNhcmRTZWxlY3RvciIsImhhbmRsZUltYWdlQ2xpY2siLCJoYW5kbGVEZWxldGVDbGljayIsImFwaSIsIm5hbWUiLCJsaW5rIiwiX2lkIiwibGlrZXMiLCJ0aGlzIiwiX25hbWUiLCJfbGluayIsIl9saWtlcyIsIl9jYXJkU2VsZWN0b3IiLCJfaGFuZGxlSW1hZ2VDbGljayIsIl9oYW5kbGVEZWxldGVDbGljayIsIl9hcGkiLCJfaXNMaWtlZCIsImxlbmd0aCIsIl9zZXRFdmVudExpc3RlbmVycyIsIl9jYXJkRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJhZGRFdmVudExpc3RlbmVyIiwiX2hhbmRsZUxpa2VJY29uIiwiX2hhbmRsZURlbGV0ZUNhcmQiLCJpc0xpa2VkIiwiX2Rpc2xpa2VDYXJkIiwiX2xpa2VDYXJkIiwibGlrZUNhcmQiLCJ0aGVuIiwiZGF0YSIsInNldElzTGlrZWQiLCJfcmVuZGVyTGlrZXMiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsImRpc2xpa2VDYXJkIiwibGlrZUJ1dHRvbiIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsImdldFZpZXciLCJkb2N1bWVudCIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJ0ZXh0Q29udGVudCIsImNhcmRJbWFnZSIsInNyYyIsImFsdCIsIm9wdGlvbnMiLCJmb3JtRWxlbWVudCIsIl9pbnB1dFNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsIl9zdWJtaXRCdXR0b25TZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiX2lucHV0RXJyb3JDbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsIl9lcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsIl9mb3JtRWxlbWVudCIsIl9zdWJtaXRCdXR0b24iLCJfaW5wdXRFbHMiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsImlucHV0RWwiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2hpZGVJbnB1dEVycm9yIiwiX3Nob3dJbnB1dEVycm9yIiwiZXJyb3JFbCIsImlkIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfaGFzSW52YWxpZElucHV0Iiwic29tZSIsIl90b2dnbGVCdXR0b25TdGF0ZSIsIl9kaXNhYmxlQnV0dG9uIiwiX2VuYWJsZUJ1dHRvbiIsImRpc2FibGVkIiwiZm9yRWFjaCIsImVuYWJsZVZhbGlkYXRpb24iLCJlIiwicHJldmVudERlZmF1bHQiLCJyZXNldFZhbGlkYXRpb24iLCJ0b2dnbGVCdXR0b25TdGF0ZSIsInBvcHVwU2VsZWN0b3IiLCJfcG9wdXBFbGVtZW50IiwiX2Nsb3NlQnV0dG9uIiwiX2hhbmRsZUVzY0Nsb3NlIiwiYmluZCIsIm9wZW4iLCJjbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJldmVudCIsImtleSIsInNldEV2ZW50TGlzdGVuZXJzIiwiZXZ0IiwidGFyZ2V0IiwiUG9wdXAiLCJoYW5kbGVGb3JtU3VibWl0Iiwic3VwZXIiLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9mb3JtIiwiX2lucHV0TGlzdCIsIl9zdWJtaXRCdXR0b25UZXh0IiwiX2dldElucHV0VmFsdWVzIiwiX2Zvcm1WYWx1ZXMiLCJpbnB1dCIsInZhbHVlIiwic2V0SW5wdXRWYWx1ZXMiLCJyZXNldCIsInJlbmRlckxvYWRpbmciLCJpc0xvYWRpbmciLCJsb2FkaW5nVGV4dCIsImFyZ3VtZW50cyIsInVuZGVmaW5lZCIsIl9pbWFnZUVsZW1lbnQiLCJfY2FwdGlvbkVsZW1lbnQiLCJQb3B1cFdpdGhDb25maXJtYXRpb24iLCJfY29uZmlybUJ1dHRvbiIsIl9jb25maXJtQnV0dG9uVGV4dCIsInNldENvbmZpcm1hdGlvbkhhbmRsZXIiLCJoYW5kbGVyIiwiX2hhbmRsZUNvbmZpcm0iLCJfZGF0YSIsIm5hbWVTZWxlY3RvciIsImpvYlNlbGVjdG9yIiwiYXZhdGFyU2VsZWN0b3IiLCJfbmFtZUVsZW1lbnQiLCJfam9iRWxlbWVudCIsIl9hdmF0YXJFbGVtZW50IiwiZ2V0VXNlckluZm8iLCJqb2IiLCJhdmF0YXIiLCJzZXRVc2VySW5mbyIsIl9yZWYyIiwiYWJvdXQiLCJzZXRVc2VyQXZhdGFyIiwiU2VjdGlvbiIsImNvbnRhaW5lclNlbGVjdG9yIiwiaXRlbXMiLCJyZW5kZXJlciIsIl9pdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJyZW5kZXJJdGVtcyIsIml0ZW0iLCJhZGRJdGVtIiwiZWxlbWVudCIsInByZXBlbmQiLCJpbml0aWFsQ2FyZHMiLCJ2YWxpZGF0aW9uT3B0aW9ucyIsIl9iYXNlVXJsIiwiYmFzZVVybCIsIl9oZWFkZXJzIiwiaGVhZGVycyIsIl9jaGVja1Jlc3BvbnNlIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImZldGNoIiwiZ2V0SW5pdGlhbENhcmRzIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhZGRDYXJkIiwiZGVsZXRlQ2FyZCIsImNhcmRJZCIsImF1dGhvcml6YXRpb24iLCJwcm9maWxlRWRpdEJ1dHRvbiIsImFkZENhcmRCdXR0b24iLCJwcm9maWxlSW1hZ2VCdXR0b24iLCJ1c2VySW5mbyIsIlVzZXJJbmZvIiwiZWRpdEZvcm1WYWxpZGF0b3IiLCJGb3JtVmFsaWRhdG9yIiwiYWRkQ2FyZEZvcm1WYWxpZGF0b3IiLCJpbWFnZVBvcHVwIiwicHJvZmlsZUVkaXRQb3B1cCIsIlBvcHVwV2l0aEZvcm0iLCJmb3JtRGF0YSIsImhlYWRpbmciLCJkZXNjcmlwdGlvbiIsImZpbmFsbHkiLCJhZGRDYXJkUG9wdXAiLCJjYXJkRGF0YSIsImNhcmRFbGVtZW50IiwiZ2V0Q2FyZEVsZW1lbnQiLCJzZWN0aW9uIiwiUG9wdXBXaXRoSW1hZ2UiLCJjb25maXJtUG9wdXAiLCJ1cGRhdGVBdmF0YXJQb3B1cCIsInVzZXJEYXRhIiwiYWxsIl0sInNvdXJjZVJvb3QiOiIifQ==